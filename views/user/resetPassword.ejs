<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" type="image/png" sizes="32x32" href="/logoTab.png">
  <title>Set Your New Password</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white flex items-center justify-center min-h-screen px-4">

  <div class="w-full max-w-md bg-white rounded-2xl shadow-md p-8">
    <h1 class="text-2xl md:text-3xl font-bold text-center text-gray-900">Set Your New Password</h1>
    <p class="text-gray-500 text-center mt-2">Create a new, secure password for your account.</p>

    <form id="resetForm" class="mt-8 space-y-5" action="/resetPassword?_method=PATCH" method="post">
      <!-- New Password -->
      <div>
        <label for="new-password" class="block text-sm font-medium text-gray-700 mb-1">New Password</label>
        <div class="relative flex items-center">
          <input id="new-password" name="resetPassword" type="password" placeholder="Enter your new password"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent pr-10" />
          <!-- toggle span holds two icons: .icon-hidden (closed eye) and .icon-visible (open eye) -->
          <span data-target="new-password" class="toggle-eye absolute right-3 cursor-pointer text-gray-500 select-none" title="Show / hide password">
            <!-- closed-eye (icon-hidden) — VISIBLE by default -->
            <svg class="icon-hidden w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 3l18 18M10.5 6.75a8.97 8.97 0 0 1 1.5-.12c4.478 0 8.268 2.943 9.542 7a9.049 9.049 0 0 1-2.034 3.362M6.73 6.73A9.061 9.061 0 0 0 2.458 12c1.274 4.057 5.064 7 9.542 7 1.358 0 2.651-.256 3.838-.724" />
            </svg>
            <!-- open-eye (icon-visible) — HIDDEN by default -->
            <svg class="icon-visible w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              <circle cx="12" cy="12" r="3" />
            </svg>
          </span>

        </div>
        <p style="color: red;"><%= resetErr %></p>

        <!-- Password Strength -->
        <div class="mt-2">
          <!-- <div class="flex justify-between text-sm text-gray-600">
            <span>Password Strength</span>
            <span id="strength-label" class="font-medium text-red-500">Weak</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-1 mt-1">
            <div id="strength-bar" class="h-1 rounded-full transition-all duration-300 bg-red-500" style="width: 25%"></div>
          </div>
        </div> -->
      </div>

      <!-- Confirm Password -->
      <div>
        <label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm New Password</label>
        <div class="relative flex items-center">
          <input id="confirm-password" name="confirmResetPass" type="password" placeholder="Confirm your new password"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent pr-10" />
          <span data-target="confirm-password" class="toggle-eye absolute right-3 cursor-pointer text-gray-500 select-none" title="Show / hide password">
            <svg class="icon-hidden w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M3 3l18 18M10.5 6.75a8.97 8.97 0 0 1 1.5-.12c4.478 0 8.268 2.943 9.542 7a9.049 9.049 0 0 1-2.034 3.362M6.73 6.73A9.061 9.061 0 0 0 2.458 12c1.274 4.057 5.064 7 9.542 7 1.358 0 2.651-.256 3.838-.724" />
            </svg>
            <svg class="icon-visible w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
              stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
              <circle cx="12" cy="12" r="3" />
            </svg>
          </span>
        </div>

        <!-- Match message -->
        <p id="matchMessage" class="mt-2 text-sm" style="color: red;"><%= confirmPassErr %></p>
      </div>

      <!-- Submit Button -->
      <button id="saveBtn" type="submit" class="w-full bg-black text-white font-semibold py-2.5 rounded-lg hover:bg-gray-800 transition-all">
        Save New Password
      </button>
    </form>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // find all toggle spans
      const toggles = document.querySelectorAll('.toggle-eye');

      toggles.forEach(span => {
        const targetId = span.dataset.target;
        const input = document.getElementById(targetId);
        const iconHidden = span.querySelector('.icon-hidden'); // closed-eye (password hidden)
        const iconVisible = span.querySelector('.icon-visible'); // open-eye (password visible)

        // ensure elements exist
        if (!input || !iconHidden || !iconVisible) {
          console.warn('toggle-eye missing parts for', targetId);
          return;
        }

        // clicking the span toggles visibility
        span.addEventListener('click', (e) => {
          e.preventDefault();
          // if input is currently password => show text
          const nowVisible = input.type === 'password';
          input.type = nowVisible ? 'text' : 'password';

          // show the correct icon:
          // when password is visible (input.type === 'text') we show iconVisible (open eye)
          if (input.type === 'text') {
            iconVisible.classList.remove('hidden');
            iconHidden.classList.add('hidden');
          } else {
            // password hidden
            iconVisible.classList.add('hidden');
            iconHidden.classList.remove('hidden');
          }

          // tiny console debug to help if you still see issues
          console.log(`[toggle-eye] ${targetId} now ${input.type}`);
        });

        // Accessibility: toggle with Enter/Space when focused
        span.setAttribute('tabindex', '0');
        span.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            span.click();
          }
        });
      });

      // // --- password strength + match logic (unchanged, robust) ---
      // const newPassword = document.getElementById('new-password');
      // const confirmPassword = document.getElementById('confirm-password');
      // const strengthBar = document.getElementById('strength-bar');
      // const strengthLabel = document.getElementById('strength-label');
      // const matchMessage = document.getElementById('matchMessage');
      // const saveBtn = document.getElementById('saveBtn');

      // function updateStrength() {
      //   const val = newPassword.value || '';
      //   let strength = 0;
      //   if (val.length >= 8) strength++;
      //   if (/[A-Z]/.test(val)) strength++;
      //   if (/[a-z]/.test(val)) strength++;
      //   if (/\d/.test(val)) strength++;
      //   if (/[\W_]/.test(val)) strength++;

      //   strengthBar.classList.remove('bg-red-500', 'bg-yellow-500', 'bg-green-500');
      //   strengthLabel.classList.remove('text-red-500', 'text-yellow-500', 'text-green-500');

      //   if (strength <= 2) {
      //     strengthBar.classList.add('bg-red-500');
      //     strengthBar.style.width = '33%';
      //     strengthLabel.textContent = 'Weak';
      //     strengthLabel.classList.add('text-red-500');
      //   } else if (strength <= 4) {
      //     strengthBar.classList.add('bg-yellow-500');
      //     strengthBar.style.width = '66%';
      //     strengthLabel.textContent = 'Medium';
      //     strengthLabel.classList.add('text-yellow-500');
      //   } else {
      //     strengthBar.classList.add('bg-green-500');
      //     strengthBar.style.width = '100%';
      //     strengthLabel.textContent = 'Strong';
      //     strengthLabel.classList.add('text-green-500');
      //   }
      // }

      // function checkMatch() {
      //   const a = newPassword.value;
      //   const b = confirmPassword.value;
      //   if (!b) {
      //     matchMessage.textContent = '';
      //     saveBtn.disabled = true;
      //     return;
      //   }
      //   if (a === b) {
      //     matchMessage.textContent = 'Passwords match';
      //     matchMessage.className = 'mt-2 text-sm text-green-600';
      //     saveBtn.disabled = false;
      //   } else {
      //     matchMessage.textContent = 'Passwords do not match';
      //     matchMessage.className = 'mt-2 text-sm text-red-600';
      //     saveBtn.disabled = true;
      //   }
      // }

      // newPassword.addEventListener('input', () => { updateStrength(); checkMatch(); });
      // confirmPassword.addEventListener('input', checkMatch);

      // // initial state
      // saveBtn.disabled = true;
    });
  </script>
</body>
</html>
