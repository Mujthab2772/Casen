<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Address Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body class="bg-gray-50">

  <!-- Header (Exactly as provided) -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/">
          <img src="/logo.png" alt="Logo" class="h-8 object-contain">
        </a>
      </div>

      <!-- Desktop Navigation -->
      <nav class="hidden md:flex space-x-5">
        <a href="/" class="text-sm font-medium transition-opacity hover:opacity-80">Home</a>
        <a href="#" class="text-sm font-medium transition-opacity hover:opacity-80">About</a>
        <a href="/products" class="text-sm font-medium transition-opacity hover:opacity-80">Phone Cases</a>
        <a href="#" class="text-sm font-medium transition-opacity hover:opacity-80">Tablet Cases</a>
        <a href="#" class="text-sm font-medium transition-opacity hover:opacity-80">Sale</a>
      </nav>

      <!-- Icons & Auth -->
      <div class="flex items-center space-x-4">
        <!-- Wishlist -->
        <button class="p-2 rounded-full hover:bg-gray-100 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" onclick="window.location.href='/profile/wishlist'">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
        </button>

        <!-- Cart -->
        <button class="p-2 rounded-full hover:bg-gray-100 transition-colors relative" onclick="window.location.href='/cart'">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
        </button>

        <!-- User Menu -->
        <% if (locals.user && user.profilePic) { %>
        <div class="relative" x-data="{ open: false }" @click.away="open = false">
          <button @click="open = !open" class="rounded-full overflow-hidden w-8 h-8 border border-transparent hover:border-gray-300 transition-colors focus:outline-none">
            <img src="<%= user.profilePic %>" alt="Profile" class="w-full h-full object-cover" />
          </button>
          <div x-show="open"
               x-transition:enter="transition ease-out duration-150"
               x-transition:enter-start="opacity-0 scale-95"
               x-transition:enter-end="opacity-100 scale-100"
               x-transition:leave="transition ease-in duration-100"
               x-transition:leave-start="opacity-100 scale-100"
               x-transition:leave-end="opacity-0 scale-95"
               class="absolute right-0 mt-2 w-44 bg-white shadow-lg rounded-lg py-1 z-50">
            <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors">Profile</a>
            <form action="/logout" method="post">
              <button type="submit" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 transition-colors">Logout</button>
            </form>
          </div>
        </div>

        <% } else if (locals.user) { %>
        <div class="relative" x-data="{ open: false }" @click.away="open = false">
          <button @click="open = !open" class="w-8 h-8 flex items-center justify-center text-gray-600 hover:text-gray-900 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </button>
          <div x-show="open"
               x-transition:enter="transition ease-out duration-150"
               x-transition:enter-start="opacity-0 scale-95"
               x-transition:enter-end="opacity-100 scale-100"
               x-transition:leave="transition ease-in duration-100"
               x-transition:leave-start="opacity-100 scale-100"
               x-transition:leave-end="opacity-0 scale-95"
               class="absolute right-0 mt-2 w-44 bg-white shadow-lg rounded-lg py-1 z-50">
            <a href="/profile" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Profile</a>
            <form action="/logout" method="post">
              <button type="submit" class="w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">Logout</button>
            </form>
          </div>
        </div>

        <% } else { %>
        <a href="/login" class="text-sm font-medium text-red-600 hover:text-red-700 transition-colors flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          Sign In
        </a>
        <% } %>

        <!-- Mobile Menu Button -->
        <button class="md:hidden text-gray-600 hover:text-gray-900">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-6">

    <!-- Sidebar (Exactly as provided) -->
    <aside class="lg:w-60 bg-white rounded-xl shadow-sm overflow-hidden">
      <nav class="p-4 space-y-1">
        <a href="/profile" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
          <i class="fas fa-user text-sm"></i>
          <span class="font-medium text-sm">Profile</span>
        </a>
        <a href="/profile/orders" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
          <i class="fas fa-shopping-cart text-sm"></i>
          <span class="font-medium text-sm">Orders</span>
        </a>
        <a href="/profile/wishlist" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
          <i class="far fa-heart text-sm"></i>
          <span class="font-medium text-sm">Wishlist</span>
        </a>
        <a href="/profile/address" class="flex items-center space-x-3 px-4 py-3 bg-black text-white rounded-lg transition-colors">
          <i class="fas fa-home text-sm"></i>
          <span class="font-medium text-sm">Address</span>
        </a>
        <a href="/profile/newPassword" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
          <i class="fas fa-lock text-sm"></i>
          <span class="font-medium text-sm">Password</span>
        </a>
        <a href="/profile/wallet" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
          <i class="fas fa-wallet text-sm"></i>
          <span class="font-medium text-sm">Wallet</span>
        </a>
        <a href="/profile/referral" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors">
          <i class="fas fa-users text-sm"></i>
          <span class="font-medium text-sm">Referral</span>
        </a>
        <a href="#" onclick="document.getElementById('logout-form').submit();" class="flex items-center space-x-3 px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors mt-4">
          <i class="fas fa-sign-out-alt text-sm"></i>
          <span class="font-medium text-sm">Logout</span>
        </a>
        <form id="logout-form" action="/logout" method="post" class="hidden"></form>
      </nav>
    </aside>

    <!-- Address Management Content -->
    <!-- Address Management Content -->
<main class="flex-1">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Address Management</h1>
      <p class="text-gray-500 mt-1">Manage your shipping and billing addresses.</p>
    </div>
    <button class="mt-4 sm:mt-0 bg-black text-white px-5 py-2 rounded-lg font-medium flex items-center space-x-2 hover:bg-gray-800 transition-colors" onclick="window.location.href='/profile/newAddress'">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
      </svg>
      <span>Add New Address</span>
    </button>
  </div>

  <!-- Address Cards -->
  <div class="space-y-6">
    <% if (locals.addresses && addresses.length > 0) { %>
      <% for (let i = 0; i < addresses.length; i++) { %>
      <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm">
        <div class="flex items-start justify-between mb-4">
          <div>
            <h3 class="text-xl font-semibold text-gray-900"><%= addresses[i].fullName %></h3>
            <% if (addresses[i].isDefault) { %>
            <span class="ml-2 inline-block bg-black text-white text-xs px-2 py-1 rounded-full">Default</span>
            <% } %>
          </div>
          <div class="flex space-x-2">
            <button class="text-gray-500 hover:text-gray-700" onclick="window.location.href='/profile/editAddress?addressId=<%= addresses[i].addressId %>'">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-5.414a2 2 0 012.828 0L18 10.586l-1.414 1.414-6 6a2 2 0 01-2.828 0A2 2 0 018 17.172V16a2 2 0 012-2h2a2 2 0 012 2v1.172a2 2 0 01-.586 1.414l-6 6z" />
              </svg>
            </button>
            <button class="text-gray-500 hover:text-red-600" onclick="confirmDeleteAddress('<%= addresses[i].addressId %>')">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M19 7l-.867 12.142A1 1 0 0117.133 20H6.867A1 1 0 016 19.133L5.133 7M20 7V5a2 2 0 00-2-2h-2.343M15 7v5m-5-5v5m-5-5v5m-2 2h16v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2z" />
              </svg>
            </button>
          </div>
        </div>
        <div class="text-gray-700 space-y-1">
          <p><%= addresses[i].streetAddress %></p>
          <p><%= addresses[i].city %>, <%= addresses[i].state %> <%= addresses[i].postalCode %></p>
          <p><%= addresses[i].country %></p>
          <p><%= addresses[i].phoneNumber %></p>
          <% if (addresses[i].secondNumber) { %>
            <p>Alt: <%= addresses[i].secondNumber %></p>
          <% } %>
        </div>
      </div>
      <% } %>
    <% } else { %>
      <div class="bg-white rounded-xl border border-gray-200 p-12 text-center">
        <div class="text-gray-400 mb-2">
          <i class="fas fa-map-marker-alt text-4xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900">No addresses yet</h3>
        <p class="text-gray-500 mt-1">Add a new shipping or billing address.</p>
        <button onclick="window.location.href='/profile/newAddress'" class="mt-4 inline-block px-4 py-2 bg-black text-white text-sm rounded-lg hover:bg-gray-800 transition">Add Address</button>
      </div>
    <% } %>
  </div>

  <!-- âœ… PAGINATION -->
  <% if (locals.pagination && pagination.totalPages > 1) { %>
    <div class="mt-8 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div class="text-sm text-gray-500">
        Showing 
        <%= (pagination.currentPage - 1) * pagination.limit + 1 %> 
        to 
        <%= Math.min(pagination.currentPage * pagination.limit, pagination.totalAddresses) %> 
        of <%= pagination.totalAddresses %> addresses
      </div>

      <div class="flex space-x-2">
        <% if (pagination.hasPrevPage) { %>
          <a href="?page=<%= pagination.currentPage - 1 %>"
             class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors">
            <i class="fas fa-chevron-left"></i>
          </a>
        <% } else { %>
          <span class="px-3 py-2 rounded-lg border border-gray-200 text-gray-400 cursor-not-allowed">
            <i class="fas fa-chevron-left"></i>
          </span>
        <% } %>

        <% for (let i = Math.max(1, pagination.currentPage - 1); i <= Math.min(pagination.totalPages, pagination.currentPage + 1); i++) { %>
          <a href="?page=<%= i %>"
             class="px-3 py-2 rounded-lg border 
                    <%= i === pagination.currentPage ? 'bg-black text-white border-black' : 'border-gray-300 text-gray-700 hover:bg-gray-50' %>
                    transition-colors">
            <%= i %>
          </a>
        <% } %>

        <% if (pagination.hasNextPage) { %>
          <a href="?page=<%= pagination.currentPage + 1 %>"
             class="px-3 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50 transition-colors">
            <i class="fas fa-chevron-right"></i>
          </a>
        <% } else { %>
          <span class="px-3 py-2 rounded-lg border border-gray-200 text-gray-400 cursor-not-allowed">
            <i class="fas fa-chevron-right"></i>
          </span>
        <% } %>
      </div>
    </div>
  <% } %>
</main>

  </div>

  <!-- Alpine.js for dropdown toggle (optional, if you want to keep dropdown behavior) -->
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
async function confirmDeleteAddress(addressId) {
  const result = await Swal.fire({
    title: 'Are you sure?',
    text: "You won't be able to undo this!",
    icon: 'warning',
    showCancelButton: true,
    confirmButtonColor: '#d33',
    cancelButtonColor: '#3085d6',
    confirmButtonText: 'Yes, delete it!',
    cancelButtonText: 'Cancel'
  });

  if (result.isConfirmed) {
    try {
      const response = await fetch(`/profile/deleteAddress?addressId=${encodeURIComponent(addressId)}`, {
        method: 'DELETE',
        headers: {
          'Content-Type': 'application/json'
        }
      });

      if (response.ok) {
        Swal.fire({
          title: 'Deleted!',
          text: 'Your address has been deleted.',
          icon: 'success',
          timer: 1500,
          showConfirmButton: false
        }).then(() => {
          // Optional: reload the page or remove the address from DOM
          window.location.reload();
        });
      } else {
        throw new Error('Failed to delete address');
      }
    } catch (error) {
      console.error('Delete error:', error);
      Swal.fire({
        title: 'Error!',
        text: 'Something went wrong. Please try again.',
        icon: 'error'
      });
    }
  }
}
</script>
</body>
</html>